\newif\ifoutreach
% \outreachtrue % comment this to hide outreach

\newif\ifskills
%\skillstrue % comment this to hide skills section

\newif\ifconferences
\conferencestrue % comment out to hide conferences section

\newif\ifreferees
%\refereestrue % comment this to hide referees

\newif\ifteaching
% \teachingtrue % comment this to hide teaching experience


\documentclass[10pt]{article}

\usepackage{marvosym}
\usepackage{fontspec}
\usepackage{xunicode,xltxtra,url,parskip}
\defaultfontfeatures{Scale=MatchLowercase,Mapping=tex-text}
\RequirePackage{color,graphicx}
\usepackage[usenames,dvipsnames]{xcolor}
\usepackage[left=1in, right=1in, top=0.3in, bottom=1in]{geometry}
\usepackage{supertabular}
\usepackage{soul}
\usepackage{titlesec}
\usepackage{multicol}
\usepackage{multirow}
\usepackage{longtable}
\usepackage{xstring}
\usepackage{rotating}
\usepackage{ifthen}


\usepackage[xetex,
            unicode,
            pdfencoding=auto,
            pdfinfo={
              Title={João Faria / CV},
              Author={João Faria},
              Subject={João Faria / CV},
              Keywords={astrophysics},
              Producer={xelatex},
              Creator{xelatex}
            },
            ]{hyperref}
\newcommand{\MYhref}[3][blue]{\href{#2}{\color{#1}{#3}}}%


%%%%%%%%%%%%%%%%%%%%%
% headers, footers
%%%%%%%%%%%%%%%%%%%%%
\usepackage{lastpage}
\usepackage{fancyhdr}
\fancypagestyle{default}{
  \fancyhf{}% No header/footer
  \renewcommand{\headrulewidth}{0pt}% No header rule
  % \fancyfoot[R]{\footnotesize\thepage/\pageref{LastPage}}% Right footer
  % \renewcommand{\footrulewidth}{0.4pt}% A footer rule
}
%
% footer for the last page with extra info
\newcommand{\footerlastpage}{%
\footnotesize{
  Last updated: \today \quad---\quad
  Online:  \href{http://j-faria.github.io/cv}{\textasciitilde jfaria/cv} \quad---\quad
  % Résumé: \href{http://resume.malloc47.com}{resume.malloc47.com} \hfill
  Source:  \href{https://github.com/j-faria/cv}{github.com/j-faria/cv/}
}
}
%
% footer (and possibly header if signed) for the first page
\fancypagestyle{firststyle}{
   \fancyhf{}
   ***signature**
   %\fancyhead[R]{\today \\ \includegraphics[height=1.5\baselineskip]{signature}}
   \fancyfoot[R]{\footnotesize\thepage/\pageref*{LastPage}}% Right footer
}
%
%
\fancypagestyle{last-page}{
  \fancyhf{}% No header/footer
  \renewcommand{\headrulewidth}{0pt}% No header rule
  ***signature**
  \fancyfoot[L]{\footnotesize \footerlastpage}
  % \fancyfoot[R]{\footnotesize\thepage/\pageref{LastPage}}% Right footer
}
\pagestyle{default}
\thispagestyle{firststyle}
% \AtEndDocument{\thispagestyle{last-page}}% Page style at \end{document}





\usepackage[absolute]{textpos}
\usepackage{enumitem}
\usepackage{tabularx}

% \usepackage{natbib}
% \usepackage[style=authoryear,natbib=true]{biblatex}
% \addbibresource{cv.bib}

% \makeatletter
% \renewcommand*{\@biblabel}[1]{\hfill[A#1]}
% \makeatother

\newcommand{\myprenote}{%
\begin{center}
 \textbf{refereed papers:} ***nrefereedpapers** \quad \textbf{total refereed citations:} ***nrefereedcitations** \\ 
 \textbf{metrics:} ***indicators**
\end{center}
\vskip1em
}
\usepackage{etaremune}
\makeatletter
\long\def\thebibliography#1{%
  \section*{\refname}%
  \@mkboth{\MakeUppercase\refname}{\MakeUppercase\refname}
  \myprenote
  \settowidth{\dimen0}{\@biblabel{#1}}%
  \setlength{\dimen2}{\dimen0}%
  \addtolength{\dimen2}{\labelsep}
  \sloppy
  \clubpenalty 4000 
  \@clubpenalty 
  \clubpenalty 
  \widowpenalty 4000
  \sfcode `\.\@m
  \renewcommand{\labelenumi}{\@biblabel{A\theenumi}} % labels like [A3], [A2], [A1]
  \begin{etaremune}[labelwidth=\dimen0,leftmargin=\dimen2]\@openbib@code
}
\def\endthebibliography{\end{etaremune}}
\def\@bibitem#1{%
  \item \if@filesw\immediate\write\@auxout{\string\bibcite{#1}{\the\value{enumi}}}\fi\ignorespaces
}
\makeatother


\include{functions}

\begin{document}
% \pagestyle{empty}

\par{\centering {\Huge João P. \textsc{Faria} }\bigskip\par}


\begin{multicols}{2}
\setlength{\parskip}{0pt}
%
\section{Contact}
\begin{tabularx}{\linewidth}{@{}l X@{}}
  \textsc{Address} & \small{***institute**} \\
                   & \small{***address**} \\
  \textsc{Phone}   & \small{***phone**}\\
  \textsc{email}   & \href{mailto:***email**}{***email**} \\
\end{tabularx}

\columnbreak

\section{Online}
\begin{tabularx}{\linewidth}{@{}l X@{}}
  \textsc{Website}  & \href{***websiteescaped**}{***website**} \\
  \textsc{github}   & \href{http://www.github.com/***github**}{github.com/***github**}\\
  \textsc{Twitter}  & \href{https://twitter.com/***twitter**}{@***twitter**} \\
  \textsc{Orcid}    & \href{http://orcid.org/***orcid**}{***orcid**} \\
  % \textsc{LinkedIn}    & \href{http://www.linkedin.com/in/}{linkedin.com/} \\
\end{tabularx}

\end{multicols}

\vspace{-2em}
\section{Research Interests}

***interests**


\newcommand{\degree}[5]{\textsc{#1} & \textbf{#2} & {\small #3} & \textsc{#4} & \textbf{#5}\\}

\section{Education}
\begin{tabular*}{\textwidth}{@{\extracolsep{\fill}}l l l p{5.5cm} r}

  ***degrees**

\end{tabular*}

\vspace{-1em}

\newcommand{\experience}[4]{
\textsc{#1} & #2 \\
\nopagebreak &\emph{#3}\\
\nopagebreak &\footnotesize{#4} \\
\nopagebreak \multicolumn{2}{c}{} \\ [-1ex]
}


\let\originalbibitem\bibitem
\def\bibitem#1#2\par{%
  \noexpandarg
  \originalbibitem{#1}
  \StrSubstitute{#2}{J.~P. {Faria}}{\textbf{J.~P. Faria}}\par}

% \nocite{*}
\nocite{Santos2016}
\nocite{Faria2016a}
\nocite{Faria2016b}
\nocite{Figueira2014}
\nocite{Mortier2015a}
\nocite{Mortier2015b}
\nocite{Santos2014}

\renewcommand\refname{Selected publications}

\renewcommand{\bibpreamble}{First. This and that can be found in~\cite{testa}. 
  The other stuff is particularly well explained in~\cite{testb} 
  and~\cite{testc}.}

\bibliography{cv}
% \bibliographystyle{aa}
\bibliographystyle{plainyr-rev}

% \printbibliography



\ifconferences

  \section{Participation in Conferences}
  \begin{itemize}

    ***conferences**

  \end{itemize}

\fi

\ifteaching

  \section{Teaching Experience}
  \begin{itemize}
    
    ***teaching**
  \end{itemize}


  % \end{longtable}

\fi

\ifoutreach

\section{Outreach}
\begin{itemize}
% \renewcommand{\labelenumi}{[G\arabic{enumi}] }
\item \emph{Mentes que Brilham (TV show)}, interview about the work published in \href{http://adsabs.harvard.edu/cgi-bin/nph-abs_connect?fforward=http://dx.doi.org/10.1051/0004-6361/201425298}{Martins et al. (2015)}, May 13, 2015.
\item \emph{Universidade Júnior (University of Porto)}, monitor of scientific activities for middle-school students, July 2013.
\item \emph{Planetarium sessions (presenter)}, as collaborator of the Outreach Unit of CAUP, Summer 2013.
\item \emph{Noites no Observatório}, monthly outreach events at the Lisbon Astronomical Observatory, 2010-2011.
\end{itemize}

\fi


% \vspace{2em}

\ifskills

  \begin{minipage}{\linewidth}
    \newcommand{\skills}[2]{
      \item #2 #1
    }
    \section{Skills \& Languages}
      \begin{multicols}{4}
        \raggedcolumns
        \begin{itemize}
          \renewcommand{\labelitemi}{}
          \renewcommand{\skill}{\textnormal}
          \setlength{\itemsep}{1pt}
          \setlength{\parskip}{0pt}
          \setlength{\parsep}{0pt}

          % \skills{\bash}{\oneskill}
          \skills{\python}{\threeskill}
          \skills{\ccpp}{\twoskill}
          %% \skills{English}{\threeskill}
          \skills{\git}{\threeskill}
          \skills{Fortran}{\threeskill}
          \skills{GNU/\linux}{\threeskill}
          %% \skills{\html}{\threeskill}
          \skills{\LaTeX}{\twoskill}
          %\skills{Learning}{\fournotes Machine}
          \skills{\matlab}{\oneskill}

        \end{itemize}
      \end{multicols}
      \begin{footnotesize}
        \raggedleft
          Large-scale and/or multi-group projects ~ \threeskill \\
          Multiple projects and/or experience teaching \twoskill \\
          Small projects or assignments \oneskill \\
      \end{footnotesize}

      \begin{center}
      \noindent\rule{8cm}{0.4pt}
      \end{center}

      \begin{multicols}{4}
        \begin{itemize}
        \renewcommand{\labelitemi}{}
        \setlength{\itemsep}{1pt}
        \setlength{\parskip}{0pt}
        \setlength{\parsep}{0pt}

        \skills{Portuguese}{\threeskill}
        \skills{French}{\oneskill}
        \skills{English}{\twoskill}
        \skills{Spanish}{\oneskill}
        \skills{~}{}
        \skills{~}{}
        \end{itemize}
      \end{multicols}
      \begin{minipage}{0.5\linewidth}
        \begin{footnotesize}
        \raggedleft
           Native speaker \threeskill \\
          Proficient \twoskill \\
          Basic understanding \oneskill \\
        \end{footnotesize}
      \end{minipage}

  \end{minipage}

\fi


% \section{Talks / Posters}
% \begin{enumerate}
% \renewcommand{\labelenumi}{[P\arabic{enumi}] }

%   ***postersANDtalks**

% \end{enumerate}

%   ***postersANDtalks**

\ifreferees

  \vspace{5in}
  {\Large\scshape\raggedright\sffamily Referees}
  \newcommand{\service}[2]{
    \textsc{#1} & #2\\[1em]
    %% \multicolumn{2}{c}{} \\
  }
  \begin{longtable}{r|p{10cm}}
    \service{Nuno C. Santos}{\href{mailto:nuno.santos@astro.up.pt}{nuno.santos@astro.up.pt}}
    \service{Pedro Figueira}{\href{mailto:pedro.figueira@astro.up.pt}{pedro.figueira@astro.up.pt}}
  \end{longtable}

\fi

% \AtEndDocument{%
%   % end-of-document content
% % \null\vfill
% \vskip2em
% \footnotesize{
%   Last updated: \today \quad---\quad
%   Online:  \href{http://j-faria.github.io/cv}{\textasciitilde jfaria/cv} \quad---\quad
%   % Résumé: \href{http://resume.malloc47.com}{resume.malloc47.com} \hfill
%   Source:  \href{https://github.com/j-faria/cv}{github.com/j-faria/cv/}
% }
% %
% }

\thispagestyle{last-page}
% \AtEndDocument{\rfoot{hello}}

\end{document}


\null\vfill
\footnotesize{
  Full version:  \href{http://j-faria.github.io/cv}{\textasciitilde jfaria/cv} \qquad %\hfill
  % Résumé: \href{http://resume.malloc47.com}{resume.malloc47.com} \hfill
  Source:  \href{https://github.com/j-faria/cv}{github.com/j-faria/cv/}
}
